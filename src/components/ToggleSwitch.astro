---
import SunIcon from "./icons/SunIcon.astro";
import MoonIcon from "./icons/MoonIcon.astro";
---

<div class="flex items-center gap-2">
  <label
    for="theme-toggle"
    class="relative inline-flex items-center cursor-pointer"
  >
    <input id="theme-toggle" type="checkbox" class="sr-only peer" />

    <div
      class="relative w-10 h-6 sm:w-8 sm:h-8 md:w-14 md:h-8 rounded-full
         bg-gray-200 dark:bg-gray-800
         peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-violet-500
         transition-colors
         peer-checked:[&>span]:translate-x-4 md:peer-checked:[&>span]:translate-x-6"
    >
      <span
        class="absolute left-[2px] sm:left-[4px] inset-y-0 my-auto
           flex items-center justify-center
           w-4 h-4 sm:w-6 sm:h-6 md:w-6 md:h-6 rounded-full
           bg-violet-800 dark:bg-violet-400
           transition-transform"
      >
        <span class="block dark:hidden w-3 h-3 sm:w-4 sm:h-4 md:w-5 md:h-5">
          <SunIcon />
        </span>
        <span class="hidden dark:block w-3 h-3 sm:w-4 sm:h-4 md:w-5 md:h-5">
          <MoonIcon />
        </span>
      </span>
    </div>
  </label>
</div>

<script>
  const checkbox = document.getElementById(
    "theme-toggle",
  ) as HTMLInputElement | null;

  if (checkbox) {
    checkbox.checked = document.documentElement.classList.contains("dark");

    checkbox.addEventListener("change", (e) => {
      const target = e.target as HTMLInputElement | null;
      const newIsDark = target?.checked ?? false;
      document.documentElement.classList.toggle("dark", newIsDark);
      localStorage.setItem("theme", newIsDark ? "dark" : "light");
    });
  }
</script>
